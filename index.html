<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!--<link rel="manifest" href="site.webmanifest">-->
        <!--<link rel="apple-touch-icon" href="icon.png">-->
        <!-- Place favicon.ico in the root directory -->

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css">
        <link rel="stylesheet" href="/css/app.css">
        <!--<style></style>-->
    </head>

    <body>
        <!--[if lte IE 9]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
        <![endif]-->

        <!-- Add your site or application content here -->
        <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.0.4/fuse.min.js"></script>-->
        <script src="https://unpkg.com/vue@2.5.2/dist/vue.js"></script>
        <script src="/js/azure-storage.common.js"></script>
        <script src="/js/azure-storage.blob.js"></script>

        <div id="app">
          <input type="file" @change="setFile"/>
        </div>
        <script>
          new Vue({
            el: "#app",
            data: {
              uploadsAreGo: false,
              sasToken: null,
              file: null
            },

            methods: {
              setFile: function (f) {
                let file = f.target.files[0]

                if (this.uploadsAreGo) {
                  this.client.createBlockBlobFromBrowserFile('mcoe-ipas', file.name, file, (err, res, resp) => {
                    if (err) console.error(err)
                    else {
                      console.info(res)
                      console.info(resp)
                    }
                  })
                }
              }
            },

            created: function () {
              fetch('https://appload-sas-token.azurewebsites.net/api/GetSasToken-Node?code=ehp76eDOr/1tEGKGtUOU0NdLXXtXtbCoL4vITYairZCaLdZCVqGaig==' // need this?
                + '&container=mcoe-ipas'
                + '&permissions=w'
                , {
                credentials: 'same-origin',
              }).then(resp => resp.json().then(data => ({ // whew
                  ok: resp.ok,
                  status: resp.status,
                  data
                })))
              .then(resp => {
                // todo error
                console.info('appload::init::got a SAS token', resp.data.token)
                this.sasToken = resp.data.token

                this.client = window.AzureStorage.createBlobServiceWithSas('https://eimsfunchello9c2a.blob.core.windows.net', this.sasToken)
                this.uploadsAreGo = true

                this.client.createBlockBlobFromText('mcoe-ipas', 'super-blob', 'woo this is a blob', (err, res, resp) => {
                  if (err) console.warn(err)
                  else {
                    console.info('applaod::createBlockBlobFromText:: success?')
                  }
                })
              })
              .catch(err => { console.error(err) })
            }
          })
        </script>
        <!--<script src="/js/app.js"></script>-->

        <!--[><script src="js/vendor/modernizr-3.5.0.min.js"></script><]-->
        <!--[><script src="js/main.js"></script><]-->

        <!--[> Google Analytics: change UA-XXXXX-Y to be your site's ID. <]-->
        <!--<script>-->
            <!--window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;-->
            <!--ga('create','UA-XXXXX-Y','auto');ga('send','pageview')-->
        <!--</script>-->
        <!--<script src="https://www.google-analytics.com/analytics.js" async defer></script>-->
    </body>
</html>
